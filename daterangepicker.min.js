/*
: Licensed under Apache License v2.0. See http://www.apache.org/licenses/LICENSE-2.0
 @website: http://www.improvely.com/
*/
(function(d){var k=function(a,b,e){var j="object"===typeof b,c,f,h,g;this.startDate=Date.today();this.endDate=Date.today();this.showDropdowns=this.cleared=this.changed=this.maxDate=this.minDate=!1;this.ranges={};this.dateLimit=!1;this.opens="right";this.cb=function(){};this.format="MM/dd/yyyy";this.separator=" - ";this.showWeekNumbers=!1;this.buttonClasses=["btn-success"];this.applyClass="btn btn-small btn-success";this.clearClass="btn btn-small";c=this.locale={applyLabel:"Apply",clearLabel:"Clear",
fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:Date.CultureInfo.shortestDayNames,monthNames:Date.CultureInfo.monthNames,firstDay:0};this.leftCalendar={month:Date.today().set({day:1,month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),calendar:[]};this.rightCalendar={month:Date.today().set({day:1,month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),calendar:[]};this.element=d(a);this.element.hasClass("pull-right")&&(this.opens="left");
if(this.element.is("input"))this.element.on({click:d.proxy(this.show,this),focus:d.proxy(this.show,this)});else this.element.on("click",d.proxy(this.show,this));j&&("object"===typeof b.locale&&d.each(c,function(a,e){c[a]=b.locale[a]||e}),b.applyClass&&(this.applyClass=b.applyClass),b.clearClass&&(this.clearClass=b.clearClass));this.container=d('<div class="daterangepicker dropdown-menu"><div class="calendar left"></div><div class="calendar right"></div><div class="ranges"><div class="range_inputs"><div class="daterangepicker_start_input" style="float: left"><label for="daterangepicker_start">'+
this.locale.fromLabel+'</label><input class="input-mini" type="text" name="daterangepicker_start" value="" disabled="disabled" /></div><div class="daterangepicker_end_input" style="float: left; padding-left: 11px"><label for="daterangepicker_end">'+this.locale.toLabel+'</label><input class="input-mini" type="text" name="daterangepicker_end" value="" disabled="disabled" /></div><button class="'+this.applyClass+' applyBtn" disabled="disabled">'+this.locale.applyLabel+'</button>&nbsp;<button class="'+
this.clearClass+' clearBtn">'+this.locale.clearLabel+"</button></div></div></div>").appendTo("body");if(j){"string"===typeof b.format&&(this.format=b.format);"string"===typeof b.separator&&(this.separator=b.separator);"string"===typeof b.startDate&&(this.startDate=Date.parseExact(b.startDate,this.format));"string"===typeof b.endDate&&(this.endDate=Date.parseExact(b.endDate,this.format));"string"===typeof b.minDate&&(this.minDate=Date.parseExact(b.minDate,this.format));"string"===typeof b.maxDate&&
(this.maxDate=Date.parseExact(b.maxDate,this.format));"object"===typeof b.startDate&&(this.startDate=b.startDate);"object"===typeof b.endDate&&(this.endDate=b.endDate);"object"===typeof b.minDate&&(this.minDate=b.minDate);"object"===typeof b.maxDate&&(this.maxDate=b.maxDate);if("object"===typeof b.ranges){for(f in b.ranges)a=b.ranges[f][0],h=b.ranges[f][1],"string"===typeof a&&(a=Date.parse(a)),"string"===typeof h&&(h=Date.parse(h)),this.minDate&&a<this.minDate&&(a=this.minDate),this.maxDate&&h>this.maxDate&&
(h=this.maxDate),this.minDate&&h<this.minDate||this.maxDate&&a>this.maxDate||(this.ranges[f]=[a,h]);a="<ul>";for(f in this.ranges)a+="<li>"+f+"</li>";a+="<li>"+this.locale.customRangeLabel+"</li>";this.container.find(".ranges").prepend(a+"</ul>")}"object"===typeof b.dateLimit&&(this.dateLimit=b.dateLimit);if("object"===typeof b.locale&&"number"===typeof b.locale.firstDay)for(f=this.locale.firstDay=b.locale.firstDay;0<f;)this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift()),f-=1;"string"===typeof b.opens&&
(this.opens=b.opens);"boolean"===typeof b.showWeekNumbers&&(this.showWeekNumbers=b.showWeekNumbers);"string"===typeof b.buttonClasses&&(this.buttonClasses=[b.buttonClasses]);"object"===typeof b.buttonClasses&&(this.buttonClasses=b.buttonClasses);"boolean"===typeof b.showDropdowns&&(this.showDropdowns=b.showDropdowns)}g=this.container;d.each(this.buttonClasses,function(a,b){g.find("button").addClass(b)});"right"===this.opens&&(f=this.container.find(".calendar.left"),a=this.container.find(".calendar.right"),
f.removeClass("left").addClass("right"),a.removeClass("right").addClass("left"));("undefined"===b||"undefined"===b.ranges)&&this.container.find(".calendar").show();"function"===typeof e&&(this.cb=e);this.container.addClass("opens"+this.opens);if((!j||"undefined"===b.startDate&&"undefined"===b.endDate)&&d(this.element).is("input[type=text]"))e=d(this.element).val(),e=e.split(this.separator),2===e.length&&(this.startDate=Date.parseExact(e[0],this.format),this.endDate=Date.parseExact(e[1],this.format));
this.container.on("mousedown",d.proxy(this.mousedown,this));this.container.find(".calendar").on("click",".prev",d.proxy(this.clickPrev,this));this.container.find(".calendar").on("click",".next",d.proxy(this.clickNext,this));this.container.find(".ranges").on("click","button.applyBtn",d.proxy(this.clickApply,this));this.container.find(".ranges").on("click","button.clearBtn",d.proxy(this.clickClear,this));this.container.find(".calendar").on("click","td.available",d.proxy(this.clickDate,this));this.container.find(".calendar").on("mouseenter",
"td.available",d.proxy(this.enterDate,this));this.container.find(".calendar").on("mouseleave","td.available",d.proxy(this.updateView,this));this.container.find(".ranges").on("click","li",d.proxy(this.clickRange,this));this.container.find(".ranges").on("mouseenter","li",d.proxy(this.enterRange,this));this.container.find(".ranges").on("mouseleave","li",d.proxy(this.updateView,this));this.container.find(".calendar").on("change","select.yearselect",d.proxy(this.updateYear,this));this.container.find(".calendar").on("change",
"select.monthselect",d.proxy(this.updateMonth,this));this.element.on("keyup",d.proxy(this.updateFromControl,this));this.updateView();this.updateCalendars()};k.prototype={constructor:k,mousedown:function(a){a.stopPropagation();(!this.showDropdowns||d(a.target).not("select").length)&&a.preventDefault()},updateView:function(){this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});
this.container.find("input[name=daterangepicker_start]").val(this.startDate.toString(this.format));this.container.find("input[name=daterangepicker_end]").val(this.endDate.toString(this.format));this.startDate.equals(this.endDate)||this.startDate.isBefore(this.endDate)?this.container.find("button.applyBtn").removeAttr("disabled"):this.container.find("button.applyBtn").attr("disabled","disabled")},updateFromControl:function(){if(this.element.is("input")){var a=this.element.val().split(this.separator),
b=Date.parseExact(a[0],this.format),a=Date.parseExact(a[1],this.format);if(!(null===b||null===a)&&!a.isBefore(b))this.startDate=b,this.endDate=a,this.updateView(),this.cb(this.startDate,this.endDate),this.updateCalendars()}},notify:function(){this.cleared||this.updateView();this.element.is("input")&&this.element.val(this.cleared?"":this.startDate.toString(this.format)+this.separator+this.endDate.toString(this.format));var a=this.cleared?null:this.startDate,b=this.cleared?null:this.endDate;this.cleared=
!1;this.cb(a,b)},move:function(){"left"===this.opens?this.container.css({top:this.element.offset().top+this.element.outerHeight(),right:d(window).width()-this.element.offset().left-this.element.outerWidth(),left:"auto"}):this.container.css({top:this.element.offset().top+this.element.outerHeight(),left:this.element.offset().left,right:"auto"})},show:function(a){this.container.show();this.move();a&&(a.stopPropagation(),a.preventDefault());this.changed=!1;this.element.trigger("shown",{target:a.target,
picker:this});d(document).on("mousedown",d.proxy(this.hide,this))},hide:function(){this.container.hide();d(document).off("mousedown",this.hide);this.changed&&(this.changed=!1,this.notify())},enterRange:function(a){a=a.target.innerHTML;a===this.locale.customRangeLabel?this.updateView():(a=this.ranges[a],this.container.find("input[name=daterangepicker_start]").val(a[0].toString(this.format)),this.container.find("input[name=daterangepicker_end]").val(a[1].toString(this.format)))},clickRange:function(a){a=
a.target.innerHTML;a===this.locale.customRangeLabel?this.container.find(".calendar").show():(a=this.ranges[a],this.startDate=a[0],this.endDate=a[1],this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()}),this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()}),this.updateCalendars(),this.changed=!0,this.container.find(".calendar").hide(),this.hide())},clickPrev:function(a){d(a.target).parents(".calendar").hasClass("left")?
this.leftCalendar.month.add({months:-1}):this.rightCalendar.month.add({months:-1});this.updateCalendars()},clickNext:function(a){d(a.target).parents(".calendar").hasClass("left")?this.leftCalendar.month.add({months:1}):this.rightCalendar.month.add({months:1});this.updateCalendars()},enterDate:function(a){var b=d(a.target).attr("title"),e=b.substr(1,1),b=b.substr(3,1);d(a.target).parents(".calendar").hasClass("left")?this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[e][b].toString(this.format)):
this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[e][b].toString(this.format))},clickDate:function(a){var b=d(a.target).attr("title"),e=b.substr(1,1),j=b.substr(3,1),b=d(a.target).parents(".calendar"),c;b.hasClass("left")?(c=this.leftCalendar.calendar[e][j],e=this.endDate,"object"===typeof this.dateLimit&&(j=(new Date(c)).add(this.dateLimit),e.isAfter(j)&&(e=j)),this.element.trigger("clicked",{dir:"left",picker:this})):(c=this.startDate,e=this.rightCalendar.calendar[e][j],
"object"===typeof this.dateLimit&&(j={days:-1*this.dateLimit.days,months:-1*this.dateLimit.months,years:-1*this.dateLimit.years},j=(new Date(e)).add(j),c.isBefore(j)&&(c=j)),this.element.trigger("clicked",{dir:"right",picker:this}));b.find("td").removeClass("active");if(c.equals(e)||c.isBefore(e)){d(a.target).addClass("active");if(!c.equals(this.startDate)||!e.equals(this.endDate))this.changed=!0;this.startDate=c;this.endDate=e}else c.isAfter(e)&&(d(a.target).addClass("active"),this.changed=!0,this.startDate=
c,this.endDate=c.clone().add(1).days());this.leftCalendar.month.set({month:this.startDate.getMonth(),year:this.startDate.getFullYear()});this.rightCalendar.month.set({month:this.endDate.getMonth(),year:this.endDate.getFullYear()});this.updateCalendars()},clickApply:function(){this.hide()},clickClear:function(){this.cleared=this.changed=!0;this.hide()},updateYear:function(a){var b=parseInt(d(a.target).val(),10);d(a.target).closest(".calendar").hasClass("left")?this.leftCalendar.month.set({month:this.startDate.getMonth(),
year:b}):this.rightCalendar.month.set({month:this.endDate.getMonth(),year:b});this.updateCalendars()},updateMonth:function(a){var b=parseInt(d(a.target).val(),10);d(a.target).closest(".calendar").hasClass("left")?this.leftCalendar.month.set({month:b,year:this.startDate.getFullYear()}):this.rightCalendar.month.set({month:b,year:this.endDate.getFullYear()});this.updateCalendars()},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.getMonth(),this.leftCalendar.month.getFullYear());
this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.getMonth(),this.rightCalendar.month.getFullYear());this.container.find(".calendar.left").html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate));this.container.find(".calendar.right").html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.startDate,this.maxDate));this.container.find(".ranges li").removeClass("active");var a=!0,b=0,e;for(e in this.ranges)this.startDate.equals(this.ranges[e][0])&&
this.endDate.equals(this.ranges[e][1])&&(a=!1,this.container.find(".ranges li:eq("+b+")").addClass("active")),b++;a&&this.container.find(".ranges li:last").addClass("active");this.element.trigger("updated",this)},buildCalendar:function(a,b){var e=Date.today().set({day:1,month:a,year:b}),d=e.clone().add(-1).day().getMonth(),c=e.clone().add(-1).day().getFullYear();Date.getDaysInMonth(b,a);var f=Date.getDaysInMonth(c,d),h=e.getDay(),e=[],g;for(g=0;6>g;g++)e[g]=[];g=f-h+this.locale.firstDay+1;g>f&&(g-=
7);h===this.locale.firstDay&&(g=f-6);d=Date.today().set({day:g,month:d,year:c});for(f=c=g=0;42>g;g++,c++,d=d.clone().add(1).day())0<g&&0===c%7&&(c=0,f++),e[f][c]=d;return e},renderDropdowns:function(a,b,e){var d=a.getMonth(),c='<select class="monthselect">',f;for(f=0;12>f;f++)c+="<option value='"+f+"'"+(f===d?" selected='selected'":"")+">"+this.locale.monthNames[f]+"</option>";c+="</select>";a=a.getFullYear();e=e&&e.getFullYear()||a+5;d=b&&b.getFullYear()||a-50;for(b='<select class="yearselect">';d<=
e;d++)b+='<option value="'+d+'"'+(d===a?' selected="selected"':"")+">"+d+"</option>";return c+(b+"</select>")},renderCalendar:function(a,b,e,j){var c='<table class="table-condensed">',f,h,g,k,c=c+"<thead>",c=c+"<tr>";this.showWeekNumbers&&(c+="<th></th>");c=!e||e<a[1][1]?c+'<th class="prev available"><i class="icon-arrow-left"></i></th>':c+"<th></th>";f=this.locale.monthNames[a[1][1].getMonth()]+a[1][1].toString(" yyyy");this.showDropdowns&&(f=this.renderDropdowns(a[1][1],e,j));c+='<th colspan="5" style="width: auto">'+
f+"</th>";c=!j||j>a[1][1]?c+'<th class="next available"><i class="icon-arrow-right"></i></th>':c+"<th></th>";c+="</tr>";c+="<tr>";this.showWeekNumbers&&(c+='<th class="week">'+this.locale.weekLabel+"</th>");d.each(this.locale.daysOfWeek,function(a,b){c+="<th>"+b+"</th>"});c+="</tr>";c+="</thead>";c+="<tbody>";for(f=0;6>f;f++){c+="<tr>";this.showWeekNumbers&&(c+='<td class="week">'+a[f][0].getWeek()+"</td>");for(h=0;7>h;h++)g="available ",g+=a[f][h].getMonth()===a[1][1].getMonth()?"":"off",b.setHours(0,
0,0,0),e&&a[f][h]<e||j&&a[f][h]>j?g=" off disabled ":a[f][h].equals(b)?(g+=" active ",a[f][h].equals(this.startDate)&&(g+=" start-date "),a[f][h].equals(this.endDate)&&(g+=" end-date ")):a[f][h]>=this.startDate&&a[f][h]<=this.endDate&&(g+=" in-range ",a[f][h].equals(this.startDate)&&(g+=" start-date "),a[f][h].equals(this.endDate)&&(g+=" end-date ")),k="r"+f+"c"+h,c+='<td class="'+g.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" title="'+k+'">'+a[f][h].getDate()+"</td>";c+="</tr>"}c+="</tbody>";
return c+="</table>"}};d.fn.daterangepicker=function(a,b){this.each(function(){var e=d(this);e.data("daterangepicker")||e.data("daterangepicker",new k(e,a,b))});return this}})(window.jQuery);
